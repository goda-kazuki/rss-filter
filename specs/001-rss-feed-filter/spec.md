# 機能仕様書: RSSフィードフィルタリング

**機能ブランチ**: `001-rss-feed-filter`  
**作成日**: 2026-02-16  
**ステータス**: ドラフト  
**要件**: "キーワードと正規表現に基づいたRSSフィードのフィルタリング機能を追加。既存コードはないため、両方の機能を一緒に実装する。ユーザーはキーワード（部分一致）または正規表現のいずれかでフィルタ条件を指定できる。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー1 - 基本的なキーワードフィルタリング (優先度: P1)

ユーザーは、関連するコンテンツを素早く見つけるために、シンプルなキーワードマッチングでRSSフィードアイテムをフィルタリングしたい。キーワード（例：「テクノロジー」）を入力すると、タイトルまたは説明にそのキーワードが含まれるフィードアイテムのみが表示される（大文字小文字を区別しない）。

**この優先度の理由**: これは最も基本的で頻繁に使用される機能です。ほとんどのユーザーはシンプルなテキスト検索機能を必要としており、高度なパターン知識なしで即座に価値を提供できます。

**独立テスト**: RSSフィードURLを提供し、「ニュース」などのキーワードを入力して、タイトルまたは説明に「ニュース」が含まれるアイテム（大文字小文字を区別しない）のみが表示されることを確認することで、完全にテストできます。

**受け入れシナリオ**:

1. **前提**: ユーザーが20件のアイテムを含むRSSフィードを読み込んでいる、**操作**: フィルタボックスにキーワード「スポーツ」を入力、**結果**: タイトルまたは説明に「スポーツ」を含むアイテムのみが表示される
2. **前提**: ユーザーがキーワード「TECH」を入力した、**操作**: フィードアイテムに「tech」、「Tech」、または「technology」が含まれている、**結果**: 「tech」または「Tech」を含むアイテムが表示される（大文字小文字を区別しない部分一致）
3. **前提**: ユーザーがキーワード「科学」を入力した、**操作**: どのフィードアイテムにもその単語が含まれていない、**結果**: 空の結果リストと「一致するアイテムが見つかりません」というメッセージが表示される
4. **前提**: ユーザーがキーワードフィルタを適用した、**操作**: フィルタボックスをクリアする、**結果**: すべての元のフィードアイテムが再び表示される

---

### ユーザーストーリー2 - 正規表現フィルタリング (優先度: P2)

高度なフィルタリングニーズを持つユーザーは、正規表現を使用して複雑なマッチングパターンを作成したい。「^Breaking:」で始まるアイテムを見つけたり、「bug-\d+」でバグ参照を見つけたりするような正規表現パターンを指定できる。

**この優先度の理由**: これはパワーユーザー向けで、フィルタリングの精密な制御が必要な場合に使用します。P1の基礎の上に構築されますが、基本機能には必須ではありません。

**独立テスト**: 「^\[News\]」のような正規表現パターンを提供し、「[News]」で始まるタイトルのアイテムのみがマッチすることを確認することで、独立してテストできます。

**受け入れシナリオ**:

1. **前提**: ユーザーが「正規表現」フィルタモードを選択した、**操作**: パターン「^Breaking:」を入力、**結果**: タイトルが「Breaking:」で始まるアイテムのみが表示される
2. **前提**: ユーザーが正規表現「\d{4}-\d{2}-\d{2}」を入力した、**操作**: フィードアイテムにYYYY-MM-DD形式の日付が含まれている、**結果**: それらのアイテムがマッチして表示される
3. **前提**: ユーザーが「[unclosed」のような無効な正規表現パターンを入力した、**操作**: フィルタを適用する、**結果**: 「無効な正規表現パターンです」というエラーメッセージが表示され、フィルタリングは行われない
4. **前提**: ユーザーが正規表現「bug-\d+」を入力した、**操作**: アイテムに「bug-123」または「bug-456」が含まれている、**結果**: それらのアイテムがマッチする

---

### ユーザーストーリー3 - フィルタモード選択 (優先度: P3)

ユーザーは、パターンを再入力することなく、キーワードと正規表現フィルタリングモードを簡単に切り替えたい。「キーワード」と「正規表現」モードを切り替えることができ、システムは新しいモードを使用して現在のパターンを再評価する。

**この優先度の理由**: これは、さまざまなマッチングアプローチを試すことでユーザビリティを向上させます。価値はありますが、コア機能には必須ではありません。

**独立テスト**: キーワードモードで「test.*data」を入力し（文字通りマッチ）、次に正規表現モードに切り替えて（パターンマッチ）、結果が適切に変更されることを確認することでテストできます。

**受け入れシナリオ**:

1. **前提**: ユーザーがキーワードモードで「test.*data」を入力した、**操作**: 正規表現モードに切り替える、**結果**: フィルタが正規表現パターンとして再適用され、結果が適切に更新される
2. **前提**: ユーザーが正規表現モードで「[News]」を入力した（文字通りのブラケットをマッチ）、**操作**: キーワードモードに切り替える、**結果**: パターンがブラケットを含む文字通りのテキストとして扱われる
3. **前提**: ユーザーがフィルタモードを切り替えた、**操作**: 現在のパターンが新しいモードで無効、**結果**: 適切なエラーメッセージが表示される

---

### エッジケース

- RSSフィードのURLに到達できない、またはエラーが返される場合はどうなるか？
- RSSフィードにアイテムが含まれていない場合はどうなるか？
- フィードアイテムにタイトルまたは説明がない場合はどうなるか？
- システムは非常に大きなフィード（10,000件以上のアイテム）をどのように処理するか？
- ユーザーが空のフィルタパターンを入力した場合はどうなるか？
- システムはキーワード内の特殊文字（引用符、バックスラッシュなど）をどのように処理するか？
- 正規表現パターンが壊滅的なバックトラッキングを引き起こす場合はどうなるか（パフォーマンス問題）？
- システムは不正なXMLのフィードをどのように処理するか？
- フィードアイテムのコンテンツにHTMLタグが含まれている場合はどうなるか？ → 正確なテキスト検索を保証するために、マッチングの前にHTMLエンティティをデコードする

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは入力としてRSSフィードURLを受け入れ、標準のRSS 2.0およびAtomフィード形式を解析しなければならない
- **FR-002**: システムは各フィードアイテムからタイトル、説明、リンク、公開日を抽出しなければならない
- **FR-003**: システムはアイテムのタイトルと説明にわたって大文字小文字を区別しない部分一致によるキーワードフィルタリングをサポートしなければならない
- **FR-004**: システムは標準的な正規表現構文を使用した正規表現フィルタリングをサポートしなければならない
- **FR-005**: システムは正規表現パターンを検証し、無効なパターンに対して明確なエラーメッセージを表示しなければならない
- **FR-006**: ユーザーは「キーワード」と「正規表現」フィルタモードを選択できなければならない
- **FR-007**: システムはユーザーが入力するか、フィルタモードを変更すると、リアルタイムでフィルタを適用しなければならない
- **FR-008**: システムはマッチするアイテムの数と総アイテム数を表示しなければならない（例：「20件中5件」）
- **FR-009**: システムは空のフィルタパターンを処理し、すべてのフィードアイテムを表示しなければならない
- **FR-010**: システムは最低限、タイトル、説明のプレビュー、リンク、日付を含むフィードアイテムを表示しなければならない
- **FR-011**: システムはフィルタ基準に一致するアイテムがない場合、適切なメッセージを表示しなければならない
- **FR-012**: システムはフィード読み込みエラーをユーザーフレンドリーなエラーメッセージで適切に処理しなければならない
- **FR-013**: システムはマッチのためにタイトルと説明の両方のフィールドを検索しなければならない
- **FR-016**: システムは正確なテキストマッチングを保証するために、フィルタを適用する前にフィードコンテンツのHTMLエンティティ（例：`&lt;` → `<`、`&amp;` → `&`）をデコードしなければならない
- **FR-014**: システムはフィルタリングされた結果を表示する際、元のフィードアイテムの順序を保持しなければならない
- **FR-015**: ユーザーはフィルタをクリアして、すべてのアイテムの表示に戻ることができなければならない

### 主要エンティティ

- **RSSフィード**: 配信フィードソースを表し、以下を含む：ソースURL、フィードタイトル、フィード説明、最終更新タイムスタンプ、フィードアイテムのコレクション
- **フィードアイテム**: フィード内の個別エントリで、以下を含む：タイトル、説明/コンテンツ、リンクURL、公開日、著者（オプション）、カテゴリ/タグ（オプション）
- **フィルタ基準**: ユーザー定義のフィルタリングルールで、以下を含む：フィルタタイプ（キーワードまたは正規表現）、パターン文字列、アクティブステータス、大文字小文字の区別設定（キーワードの場合）
- **フィルタリング結果セット**: フィルタを適用した結果で、以下を含む：マッチするフィードアイテム、総マッチ数、使用されたフィルタ基準

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは1000件までのフィードに対して、キーワードフィルタを適用して2秒以内に結果を確認できる
- **SC-002**: キーワード検索の95%が正確な結果を返す（一致するアイテムがすべて表示され、誤検出がない）
- **SC-003**: システムは無効な正規表現パターンを正しく識別し、有用なエラーメッセージで報告する
- **SC-004**: ユーザーはフィルタモードを切り替えて、1秒以内に更新された結果を確認できる
- **SC-005**: 90%のユーザーが、説明書やヘルプドキュメントなしで最初のフィルタを正常に作成できる
- **SC-006**: システムはパフォーマンス低下なしで5000件以上のアイテムを含むフィードを処理する（フィルタリングが5秒以内に完了）
- **SC-007**: フィード読み込みエラーは明確で実行可能なメッセージで表示される（例：「フィードURLに到達できません。URLを確認して再試行してください。」）
- **SC-008**: 一般的なパターン（メールアドレス、日付、URLなど）に対して98%の正規表現フィルタリング精度

## 前提条件

- ユーザーは基本的なテキスト検索の概念に精通している
- 正規表現フィルタリングを試みるユーザーは、正規表現の基本的な理解があるか、学ぶ意欲がある
- RSSフィードは公開アクセス可能である（認証不要）
- フィードコンテンツは主にプレーンテキストまたはシンプルなHTMLである
- フィルタリングはクライアント側で行われる（最初はサーバー側の永続化は不要）
- フィードは英語であるか、ユーザーがフィード言語を理解している
- 標準的な正規表現構文で十分である（後読み、アトミックグループなどの高度な正規表現機能は不要）
- ユーザーはJavaScriptが有効になっている最新のWebブラウザを使用している
- パフォーマンス期待値は典型的なRSSフィードサイズ（100〜1000件のアイテム）に基づいている

## スコープ外

- セッション間でのフィルタ設定の保存または永続化
- マルチフィード集約または複数フィードの同時フィルタリング
- フィードの購読または自動フィード更新/ポーリング
- ユーザー認証またはマルチユーザーサポート
- フィード発見またはフィード推奨機能
- 日付範囲フィルタリング、著者フィルタリング、カテゴリフィルタリングなどの高度なフィルタリング
- フィルタリング結果のエクスポート
- フィードアイテムのスター付け、ブックマーク、既読/未読ステータス
- モバイル専用インターフェースの最適化（レスポンシブデザインは想定）
- オフラインアクセスまたはフィードコンテンツのキャッシング
- 外部サービスまたはAPIとの統合
